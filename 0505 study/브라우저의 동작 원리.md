# 브라우저의 동작 원리

## 브라우저의 핵심 기능

클라이언트가 참조하고자 하는 웹페이지를 서버에 요청(request)하고, 서버의 응답(response)을 받아 브라우저에 표시하는 것이다. 브라우저는 서버로부터 HTML, CSS, Javascript, 이미지 파일 등을 응답받는다. HTML, CSS 파일은 렌더링 엔진의 HTML 파서와 CSS 파서에 의해 파싱(Parsing)되어 DOM, CSSOM 트리로 변환되고 렌더 트리로 결합된다. 이렇게 생성된 렌더 트리를 기반으로 브라우저는 웹페이지를 표시한다.

<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fc9Gish%2FbtqJ1LZPB91%2FpafhBmxcd6LuuH77pQ4Tp1%2Fimg.png">
사용자가 브라우저를 통해 네이버를 보는 예

## 브라우저의 구성요소

1. 사용자 인터페이스 <br> 주소표시줄, 이전/다음 버튼, 북마크 메뉴 등 요청한 페이지를 보여주는 창을 제외한 나머지 모든 부분
2. 브라우저 엔진 <br> 사용자 인터페이스와 렌더링 엔진 사이의 동작을 제어
3. 렌더링 엔진 <br> 사용자 인터페이스에서 요청한 콘텐츠를 표시. 예를 들어 HTML을 요청하면 HTML을 파싱하여 화면에 표시
4. 통신 <br> HTTP Request와 같은 네트워크 호출에 사용. 플랫폼에 독립적인 인터페이스고 플랫폼 하부에서 실행
5. UI 백엔드 <br> 콤보박스와 창같은 기본 장치를 그림. 플랫폼에서 명시하지 않은 일반적인 인터페이스로서, OS의 UI체계를 사용
6. 자바스크립트 해석기 <br> 자바스크립트 코드를 해석하고 실행
7. 자료 저장소 <br> 쿠키를 저장하는 것과 같은 모든 종류의 자원을 하드디스크에 저장하는 공간. HTML5 명세에는 브라우저가 지원하는 ‘Web storage‘ 명세 존재

## 브라우저 내부 구조

<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fbux4a9%2FbtqtZO4Zp3P%2FbKSqTgKzNG5JCZ2vGGKPUK%2Fimg.png">

크롬은 대부분의 브라우저와 달리 각 탭마다 별도의 렌더링 엔진 인스턴스를 유지한다. 각 탭은 독립된 프로세스로 처리된다.

## 렌더링 엔진

요청받은 내용(HTML, CSS)을 브라우저 화면에 표시하는 일이다. **파싱**을 통해 만든 렌더 트리를 토대로 펭지를 구성한다. 빠른 구성을 위해 트리를 완성하지 않아도 부분적인 렌더링 작업을 한다.

## 파싱

문서 파싱은 브라우저가 코드를 이해하고 사용할 수 있는 구조로 변환하는 것을 의미한다.

## 렌더링 엔진의 종류

파이어폭스는 모질라에서 직접 만든 게코 엔진을. 사파리는 웹킷 엔진을. 크롬 역시 웹킷 엔진을 사용했으나 2013년 부터 Blink라는 웹킷에서 파생된 엔진을 사용하기 시작했다.

자바스크립트는 **구글의 Chrome V8 자바스크립트 엔진**으로 빌드된 자바스크립트 런타임 환경(Runtime Environment)인 Node.js의 등장으로, 웹 브라우저를 벗어나 서버 사이드 애플리케이션 개발에서도 사용되는 범용 개발 언어가 되었다. 하지만 자바스크립트가 가장 많이 사용되는 분야는 역시 웹 브라우저 환경에서 동작하는 웹 페이지/애플리케이션이다.

## 동작과정

<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbgA1Um%2FbtqtY0rjy2Y%2FjYz9kQvIKXlOOpgVqI7KZ1%2Fimg.png">

1. 문서를 파싱한다.
   - HTML 문서를 파싱하여 → 돔 구조를 만든다.
   - CSS를 파싱하여 → CSS 오브젝트 모델을 만든다.
2. 렌더트리를 생성한다.
3. 렌더트리 생성이 끝나면 배치가 시작된다. (레이아웃 과정) 이것은 각 노드가 화면의 정확한 위치에 표시되는 것을 의미한다.
4. 그 다음 그리기(페인팅) 과정이 진행된다.

위의 일련의 과정들이 점진적으로 진행되지만 렌더링 엔진은 사용자 경험도 고려하여 모든 HTML의 파싱을 기다렸다가 한번에 하지는 않고 일부 HTML 먼저 배치와 그리기 과정을 시작한다.

### **서버 요청과 응답**

1. 사용자의 요청을 서버에 요청(Request) 하고, 서버로부터

HTML, CSS, Javascript, 이미지 파일 등을 응답받는다.

### **HTML, CSS 처리 (렌더링 엔진)**

1. 렌더링 엔진의 HTML,CSS 파서에 의해 파싱(Parsing)되어

2. DOM, CSSOM 트리로 변환되고 렌더 트리로 결합된다.

3. 생성된 렌더 트리를 기반으로 브라우저는 웹페이지를 표시한다.

- 렌더링 엔진이란 요청받은 내용을 브라우저 화면에 표시하는 역할을 한다.

### **Javascript를 처리 ( 자바스크립트 엔진)**

1. 렌더링 엔진의 HTML 파서가 script 태그를 만나면 DOM 생성 작업을 중지하고 자바스크립트 엔진으로 제어 권한을 넘긴다.

2. 제어 권한을 넘겨 받은 자바스크립트 엔진은 script 태그의 src 속성에 정의된 자바스크립트 파일을 불러오고 파싱하여 실행한다.

3. 자바 스크립트의 실행이 완료되면 다시 렌더링 엔진의 HTML 파서로 제어 권한을 넘긴다.

4. 렌더링엔진은 중지했던 시점부터 DOM 생성을 재개한다.

- 자바스크립트는 렌더링엔진이 아닌 자바스크립트 엔진이 처리한다. 자바스크립트 해석기라고도 한다.

## 끝으로 Script 태그의 위치는 중요한 의미를 갖는다.

브라우저는 동기(Synchronous)적으로 HTML, CSS, JS를 처리한다.

따라서 script태그 위치에 따라 DOM 생성 프로세스에 영향을 준다. 자칫 블로킹이 발생할 수 있다.

그렇다면 script 태그는 어디다 두어야 하는가?

body 요소의 가장 아래에 태그를 위치시키는 것을 권장하고 있다. 그 이유는 아래와 같다.

- HTML 요소들이 스크립트 로딩 지연으로 인해 렌더링에 지장 받는 일이 발생하지 않아 페이지 로딩 시간이 단축되기 때문에

- DOM이 완성되지 않은 상태에서 자바스크립트가 DOM을 조작한다면 에러가 발생하기 때문에
